{% extends 'base.html' %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-6">
    <h2 class="mb-3">Cargar Guías desde Excel/CSV</h2>
    <form
      action="{{ url_for('main.upload') }}"
      method="post"
      enctype="multipart/form-data"
    >
      <div class="mb-3">
        <label for="file" class="form-label">Archivo (.xlsx o .csv)</label>
        <input type="file" name="excel_file" {# Cambiado de 'file' a
        'excel_file' para coincidir con el backend #} id="excel_file" {#
        Cambiado de 'file' a 'excel_file' #} class="form-control"
        accept=".xlsx,.csv" required />
      </div>
      <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
        {# Añadido w-100 y mb-3 para responsividad #} {% if current_session and
        current_session.guia_statuses|length > 0 %} Reemplazar Guías {% else %}
        Cargar Guías {% endif %}
      </button>
    </form>

    {% if current_session and current_session.guia_statuses|length > 0 %}
    <div class="mt-3 d-grid gap-2">
      {# Añadido d-grid gap-2 para responsividad #}
      <form
        action="{{ url_for('main.delete_current_excel') }}"
        method="post"
        onsubmit="return confirm('¿Estás seguro de que quieres eliminar todas las guías de la sesión actual? Esta acción no se puede deshacer?');"
      >
        <button type="submit" class="btn btn-danger btn-lg w-100">
          Eliminar Guías de la Sesión Actual
        </button>
        {# Añadido w-100 #}
      </form>
    </div>
    {% endif %}

    <div class="alert alert-info mt-3">
      El archivo debe tener columnas: <b>TRACKING</b>,
      <b>GUIA INTERNACIONAL</b>.
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // Actualizar los contadores del footer al cargar la página
  document.addEventListener('DOMContentLoaded', () => {
    const escaneados = document.getElementById('footer-escaneados');
    const faltantes = document.getElementById('footer-faltantes');
    const noEsperados = document.getElementById('footer-no-esperados');

    const totalScanned = Number({{ footer_counts.total_scanned_packages | default(0) }});
    const totalPackages = Number({{ footer_counts.total_packages | default(0) }});
    const notRegistered = Number({{ footer_counts.not_registered_packages | default(0) }});
    if (escaneados && faltantes && noEsperados) {
      escaneados.textContent = totalScanned;
      faltantes.textContent = (totalPackages - totalScanned) >= 0 ? (totalPackages - totalScanned) : 0;
      noEsperados.textContent = notRegistered;
    }
  });
</script>
{% endblock %} {% include 'footer_counter.html' %}
