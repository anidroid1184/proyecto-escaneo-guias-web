{% extends 'base.html' %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-6">
    <h2 class="mb-3">Finalizar Sesión</h2>
    {% if current_session %} {% if current_session %}
    <p>
      Estás a punto de finalizar la sesión del día:
      <strong>{{ current_session.session_date.strftime('%Y-%m-%d') }}</strong>.
    </p>
    {% else %}
    <p>No hay sesión activa para finalizar.</p>
    {% endif %}
    <p>
      Al finalizar la sesión, todas las guías que aún estén en estado "NO
      RECIBIDO" se marcarán automáticamente como "NO ESCANEADO".
    </p>
    <p>
      Para confirmar, por favor, escribe la fecha de la sesión (YYYY-MM-DD) en
      el campo de abajo:
    </p>
    <form method="POST">
      <div class="mb-3">
        <label for="confirmation_date" class="form-label"
          >Fecha de la Sesión</label
        >
        <input
          type="text"
          id="confirmation_date"
          name="confirmation_date"
          class="form-control"
          placeholder="YYYY-MM-DD"
          value="{% if current_session %}{{ current_session.session_date.strftime('%Y-%m-%d') }}{% endif %}"
          required
        />
      </div>
      <button type="submit" class="btn btn-danger">
        Confirmar y Finalizar Sesión
      </button>
      <a href="{{ url_for('main.index') }}" class="btn btn-secondary ms-2"
        >Cancelar</a
      >
    </form>

    {% if summary %}
    <div class="card mt-4 shadow-sm">
      <div class="card-header bg-success text-white">
        Resumen de la Sesión Finalizada
      </div>
      <div class="card-body">
        <p class="card-text">
          <strong>Total de Paquetes Escaneados:</strong>
          <span class="badge bg-primary">{{ summary.total_scanned }}</span>
        </p>
        <p class="card-text">
          <strong>Paquetes Desconocidos Registrados:</strong>
          <span class="badge bg-warning text-dark">{{ summary.unknown }}</span>
        </p>
        <p class="card-text">
          <strong>Paquetes Faltantes (No Escaneados):</strong>
          <span class="badge bg-danger">{{ summary.missing }}</span>
        </p>
      </div>
    </div>
    {% endif %} {% else %}
    <div class="alert alert-info">No hay una sesión activa para finalizar.</div>
    <a href="{{ url_for('main.index') }}" class="btn btn-primary"
      >Ir a Inicio</a
    >
    {% endif %}
  </div>
</div>
{% endblock %}
